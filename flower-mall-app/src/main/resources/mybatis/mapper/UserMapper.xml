<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.example.infrastructure.dao.IUserDao">

    <!-- 结果映射，防止数据库下划线与Java驼峰命名冲突 -->
    <resultMap id="BaseResultMap" type="org.example.infrastructure.dao.po.User">
        <id column="id" property="id"/>
        <result column="account" property="account"/>
        <result column="name" property="name"/> <!-- 注意：你PO里字段叫username还是name? -->
        <result column="password" property="password"/>
        <result column="phone" property="phone"/>
        <result column="address" property="address"/>
        <result column="role" property="role"/>
    </resultMap>

    <!-- 对应 find -->
    <select id="find" resultMap="BaseResultMap">
        select * from users
        where (account like concat('%',#{searchKey},'%') or name like concat('%',#{searchKey},'%'))
          and role = 'user'
    </select>

    <!-- 对应 queryById -->
    <select id="queryById" resultMap="BaseResultMap">
        select * from users where id = #{id}
    </select>

    <!-- 对应 queryInfo -->
    <select id="queryInfo" resultMap="BaseResultMap">
        select * from users where account = #{account} and role = 'user'
    </select>

    <!-- 对应 update -->
    <update id="update" parameterType="org.example.infrastructure.dao.po.User">
        update users
        set name = #{name},
            password = #{password},
            phone = #{phone},
            address = #{address}
        where id = #{id}
    </update>

    <!-- 对应 delete -->
    <delete id="delete">
        delete from users where id = #{id}
    </delete>

    <!-- 对应 add，并返回自增ID -->
    <insert id="add" parameterType="org.example.infrastructure.dao.po.User" useGeneratedKeys="true" keyProperty="id">
        insert into users(account,name,password,phone,address,role)
        values(#{account},#{name},#{password},#{phone},#{address},'user')
    </insert>

</mapper>